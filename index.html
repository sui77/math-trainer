<!DOCTYPE html>
<html lang="de">
<head>
    <title>Mathe Trainer</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
            integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
        .btn-num {
            width: calc(30% - 20px);
            height: calc(22% - 20px);
            font-size: 24px;

            margin-right: 20px;
            margin-bottom: 20px;
        }

        .btn-select-challenge {
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .challengebox {
            border: solid 2px #888;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;
            /*font-size:20em;*/
            height: calc(22% - 20px);
            min-height: 70px;
            background-repeat: no-repeat;
            background-size: contain;
            background-position: right;

        }

        .challengebox-no {
            background-image: url(data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAMAAADyHTlpAAAB1FBMVEUAAADhcEbkdUL0lizuiDTrgjf0liv0lSzwjDHthjXshTX3nSj2mSr2mSrvjDLvizHpgDr1lyr1mSrwjjDwjTHxji7vijHvijHvijPtiDTshDb2nSnyki7ykS7ykC3ykC7rjzrrjjrvijHuhzPthzPqgTrqgjjshDbshDXxkDDzkizxkDDzki3tiDXuiDTshTbrhDf/xyr/xSr/1Wz/3IT/ykn/2Hj/4pr/34/9uCj/zVT4oCf/0WD/5aT/6K7/yyv+wCj8tij/yir/67n7rif/yTb7qyb8tCf9uij5oyf+wyn3nij/ykL/yC/5pyf7rCX/7cX/0Vr/yjr+zDD9vCj5piaNUCL/zUz9uS36z1//y0bHpTz8sSaESyBuQhxXKQ9ZJQ7/4Zb/2Xz/1nWohDP4yjL1xinwwCjetif6pyaLZiTAmCKtiR9dMxH/7cP/5qr/5KHyylz+y1b4y1PqwU/2yTysizr9wDnVtDnbtzfBnzavjTSxjjGXdTH+xC+Wbyv3yir6yCqLXCd8WCbPrCWaWSXPpiSHUiPDmyK8lSG4kCB8Rx6jfh10Qx2bdByDWxh0TBVrQRP/3Ir+yE71yUn+xEH+xD6ohTDFqyXMpCS0jyChgR6ACgAXAAAAMXRSTlMAAwbsbiLm3JJNO/z184t/IuzysZ2db2Z6Z0X80dGxsJWIbkVFKysrK9HR0NB6Z0Y6UuurcwAAAwxJREFUOMuNlWdb2lAUgAMEEAQFZ511a3cTsRiiJsEMNmWqIFL3HnXvvbWO7vFne0nyoMz2/XQe7svJSc6950JJSOX1pfl5efmlDXIplAVJS0m1UpuLA3K1yuqSZkkmUV2ssAfc/VQvgOp3B+yKYnVaWZ6jt7qptcXhz4MLC8b24cU1ym2V5chTU6qe4+7eL4b57rn3PHPdnUNtmBuvVCUlltbpA9y3oa7uBOaHvnOTeliaYD7RsJjJ2JXCoAljNU8euZI6DWvxGDvTYPRY3Br4oQaVnrX0tBvTMmiysDJV/N1fBjCvoT0DBgfmqpKLj8/Bud1WQ0Zadzk8RyhBrWdJx/C7zIRIWqbmkxZbKdTTmgUPilmLYmlbFCzJeDoE+j72daSEHoakFU1ALbFzKGMSWN45Wl0SwqXVo51l8WcvStlh8PWfBiwo08bTMzLwaSDcw4dhEI6AMIYX8bsKpZBcyZIIr4YcK1OR4NUPLwPwjlwFI1NfBZVBSFqpg+q1/TbE6Qg5GCcyuhc8iWwTCIDYjpwE91YYryPU5nAiNq7gDVSaS6EI4nTy65tnwcMNcyw0bxwGzzZj/3IyYA2lcl9D+TgGVJHR8Na6Twh961vh0fgCiuH5UJ6oioKPQEQInw95rOZBNaKaHdCEGqj2P1W8Vnitf6tURRnUEPtYiZjNBEGYzQkqV1AOWkCTCR4xNvFr+vJy+nRiLG7zLeAb+0jcP765m/0AiEZn72bGEQGhsWC7PBRLHN9Go/e3NzMX5+fTv6//TIh5he0CNSviFezPzN5fn44fxEoVCo4/X9EobG3xcxE/py7GwXIKwtYGqGViWvPYAfDSIBwY8RjakCzYKOEYAuSVkxiarVOuF7r4yJCxFjSj6edHhogE1gA3k0lrYUnSeLOlrdPCal8ljkJYNsmRaEpKknLJYGnyKK7CaQzICSJG489UkjQDXmalKT9pQwVIP0WDAa9Le228LVLYXTRHYQCKo112RZE64x3TBBcqC/jLqKJAWQg3AjEzUl15WeyKKyvXJV9xfwHV+DwL3fD4QAAAAABJRU5ErkJggg==);
        }

        .challengebox-yeah {
            background-image: url(data:image/gif;base64,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);
        }

        #question, #result {
            font-size: 30px;
            font-weight: bold;
        }

    </style>
</head>
<body>
<div class="jumbotron text-center">
    <h1>Mathe-Trainer</h1>
    <p>Einfacher Mathe Trainer für Grundrechenarten in der Grundschule.</p>
</div>

<div id="select" class="container">
    <div class="form-group">
        <label for="num">Wieviele Aufgaben?</label>
        <input name="num" value="150" class="form-control" id="num" placeholder="">
    </div>
    <div id="challenge-select"></div>
    <div>
        <button type="submit" class="btn btn-default js-start">Start</button>
    </div>
</div>


<div id="main" class="row" style="display:none;margin-left:2%">

    <div class="col-sm-5">
        <div class="challengebox alert"><span id="question" class="resize"></span><span id="result"></span></div>


        <div style="margin-bottom:1px;">
            <table class="table table-striped">
                <tr>
                    <td>Noch zu lösen</td>
                    <td id="stat-remaining" class="text-right"></td>
                </tr>
                <tr>
                    <td>Richtig</td>
                    <td id="stat-correct" class="text-right"></td>
                </tr>
                <tr>
                    <td>Falsch</td>
                    <td id="stat-wrong" class="text-right"></td>
                </tr>
                <tr>
                    <td>Gesamtzeit</td>
                    <td id="stat-timetotal" class="text-right">-</td>
                </tr>
                <tr>
                    <td>Durchschnittszeit</td>
                    <td id="stat-timeaverage" class="text-right">-</td>
                </tr>
            </table>
        </div>

    </div>

    <div class="col-sm-7">
        <div>
            <button type="button" data-num="1" class="btnd-1 btn btn-num btn-primary">1</button>
            <button type="button" data-num="2" class="btnd-2 btn btn-num btn-primary">2</button>
            <button type="button" data-num="3" class="btnd-3 btn btn-num btn-primary">3</button>
        </div>
        <div>
            <button type="button" data-num="4" class="btnd-4 btn btn-num btn-primary">4</button>
            <button type="button" data-num="5" class="btnd-5 btn btn-num btn-primary">5</button>
            <button type="button" data-num="6" class="btnd-6 btn btn-num btn-primary">6</button>
        </div>
        <div>
            <button type="button" data-num="7" class="btnd-7 btn btn-num btn-primary">7</button>
            <button type="button" data-num="8" class="btnd-8 btn btn-num btn-primary">8</button>
            <button type="button" data-num="9" class="btnd-9 btn btn-num btn-primary">9</button>
        </div>
        <div>
            <button type="button" data-num="C" class="btnd-11 btn btn-num btn-primary">C</button>
            <button type="button" data-num="0" class="btnd-10 btn btn-num btn-primary">0</button>
            <button type="button" data-num="OK" class="btnd-12 btn btn-num btn-primary">OK</button>
        </div>
    </div>

</div>


<script type="text/javascript">
    var challengeDefinition = {
        'multiplication': function (n) {

            this.n = n;

            this.init = function () {
                var rand = Math.floor((Math.random() * 10) + 1);
                if (Math.random() < 0.5) {
                    this.n1 = this.n;
                    this.n2 = rand;
                } else {
                    this.n2 = this.n;
                    this.n1 = rand;
                }
            };

            this.getText = function () {
                return this.n1 + ' x ' + this.n2 + ' = ';
            };

            this.getResult = function () {
                return this.n1 * this.n2;
            };

            this.getSelectButtonText = function () {
                return '1x' + this.n;
            }

        },
        'division': function (n) {

            this.n = n;

            this.init = function () {
                var rand = Math.floor((Math.random() * 10) + 1);
                this.n1 = this.n * rand;
                this.n2 = this.n;
            };

            this.getText = function () {
                return this.n1 + ' / ' + this.n2 + ' = ';
            };

            this.getResult = function () {
                return this.n1 / this.n2;
            };

            this.getSelectButtonText = function () {
                return '/' + this.n;
            }

        },

        'addition': function (n) {

            this.n = n;

            this.init = function () {
                do {
                    this.n1 = Math.floor((Math.random() * this.n) + 1);
                    this.n2 = Math.floor((Math.random() * this.n) + 1);
                } while (this.n1 + this.n2 > this.n);
            };

            this.getText = function () {
                return this.n1 + ' + ' + this.n2 + ' = ';
            };

            this.getResult = function () {
                return this.n1 + this.n2;
            };

            this.getSelectButtonText = function () {
                return '+ bis ' + this.n;
            }

        },
        'substraction': function (n) {

            this.n = n;

            this.init = function () {
                do {
                    this.n1 = Math.floor((Math.random() * this.n) + 1);
                    this.n2 = Math.floor((Math.random() * this.n) + 1);
                } while (this.n1 - this.n2 < 0);
            };

            this.getText = function () {
                return this.n1 + ' - ' + this.n2 + ' = ';
            };

            this.getResult = function () {
                return this.n1 - this.n2;
            };

            this.getSelectButtonText = function () {
                return '- bis ' + this.n;
            }

        }

    };


    var Mathe = function () {

        this.availableChallenges = {
            '1x1': new challengeDefinition.multiplication(1),
            '1x2': new challengeDefinition.multiplication(2),
            '1x3': new challengeDefinition.multiplication(3),
            '1x4': new challengeDefinition.multiplication(4),
            '1x5': new challengeDefinition.multiplication(5),
            '1x6': new challengeDefinition.multiplication(6),
            '1x7': new challengeDefinition.multiplication(7),
            '1x8': new challengeDefinition.multiplication(8),
            '1x9': new challengeDefinition.multiplication(9),
            '1x10': new challengeDefinition.multiplication(10),

            '1/1': new challengeDefinition.division(1),
            '1/2': new challengeDefinition.division(2),
            '1/3': new challengeDefinition.division(3),
            '1/4': new challengeDefinition.division(4),
            '1/5': new challengeDefinition.division(5),
            '1/6': new challengeDefinition.division(6),
            '1/7': new challengeDefinition.division(7),
            '1/8': new challengeDefinition.division(8),
            '1/9': new challengeDefinition.division(9),
            '1/10': new challengeDefinition.division(10),

            'plus10': new challengeDefinition.addition(10),
            'plus20': new challengeDefinition.addition(20),
            'minus10': new challengeDefinition.substraction(10),
            'minus20': new challengeDefinition.substraction(20)
        };

        this.challenges = [];

        this.number = 0;

        this.solved = {correct: 0, wrong: 0};

        this.current = null;

        this.startTime = 0;

        this.timeTotal = 0;

        this.previouskey = 'none';

        this.init = function (challenges, number) {
            this.challenges = challenges;
            this.number = number * 1;
            this.updateStats();
        };

        this.updateStats = function () {
            $('#stat-remaining').html(this.number - this.solved.correct);
            $('#stat-correct').html(this.solved.correct);
            $('#stat-wrong').html(this.solved.wrong);
            if (this.timeTotal != 0) {
                $('#stat-timetotal').html(Math.round(this.timeTotal / 1000) + 's');
                $('#stat-timeaverage').html((this.timeTotal / (this.solved.correct + this.solved.wrong) / 1000).toFixed(2) + 's');
            }
        };

        this.next = function (repeatchallenge) {
            $('.challengebox').removeClass('alert-danger').removeClass('alert-success');
            $('.challengebox').removeClass('challengebox-no').removeClass('challengebox-yeah');
            $('.btn-num').removeAttr('disabled');
            $('#result').html('');

            this.startTime = new Date().getTime();
            if (!repeatchallenge) {
                var n = Math.floor(Math.random() * this.challenges.length);
                this.current = this.availableChallenges[this.challenges[n]];
                this.current.init();
            }
            $('#question').html(this.current.getText());

        };

        this.resolve = function (result) {

            var time = (new Date().getTime() - this.startTime);
            if (this.current.getResult() == result) {
                $('.challengebox').removeClass('challengebox-no').addClass('alert-success challengebox-yeah');
                this.solved.correct += 1;
                this.nextTimer(1, false);
            } else {
                $('.challengebox').removeClass('challengebox-yeah').addClass('alert-danger challengebox-no');
                this.solved.wrong += 1;
                this.nextTimer(1, true);
            }
            this.timeTotal += time;
            this.updateStats();
        };

        this.renderChallengeButtons = function () {
            $('#challenge-select').html('');
            for (key in this.availableChallenges) {
                $('#challenge-select').append($('<button type="button" class="js-sel btn btn-default btn-lg btn-select-challenge" data-val="' + key + '">' + this.availableChallenges[key].getSelectButtonText() + '</button>'));
            }
        };

        this.nextTimer = function (n, repeatChallenge) {
            if (n < 3) {
                self = this;
                window.setTimeout(function () {
                    self.nextTimer(n + 1, repeatChallenge);
                }, 1000);
            } else {
                this.next(repeatChallenge);
            }
        };

    };

    $(function () {

        var clickEvent = ((document.ontouchstart !== null) ? 'click' : 'touchstart');

        var M = new Mathe();
        M.renderChallengeButtons();

        $(document).on('click', '.js-sel', function (e) {
            e.preventDefault();
            $(this).toggleClass('btn-success');
            $(this).blur();
        });

        $('.js-start').on('click', function (e) {
            e.preventDefault();
            $('#select').hide();
            $('#main').show();
            var c = [];
            $('.js-sel.btn-success').each(function (el) {
                c.push($(this).data('val'));
            });
            M.init(c, $('#num').val());
            M.next();
        });

        $(document).on(clickEvent, '.btn-num', function (event) {
            if (event.handled === false) return;
            event.stopPropagation();
            event.preventDefault();
            event.handled = true;

            var num = $(this).data('num');
            if (num == 'C') {
                $('#result').html('');
            } else if (num == 'OK') {
                $('.btn-num').attr('disabled', 'disabled');
                M.resolve($('#result').html());
            } else {
                $('#result').html($('#result').html() + num);
            }

        });

        $(document).on('keyup', function (e) {
            e.preventDefault();
            switch (e.keyCode) {
                case 96:
                case 48:
                    $('#result').html($('#result').html() + '0');
                    break;
                case 97:
                case 49:
                    $('#result').html($('#result').html() + '1');
                    break;
                case 98:
                case 50:
                    $('#result').html($('#result').html() + '2');
                    break;
                case 99:
                case 51:
                    $('#result').html($('#result').html() + '3');
                    break;
                case 100:
                case 52:
                    $('#result').html($('#result').html() + '4');
                    break;
                case 101:
                case 53:
                    $('#result').html($('#result').html() + '5');
                    break;
                case 102:
                case 54:
                    $('#result').html($('#result').html() + '6');
                    break;
                case 103:
                case 55:
                    $('#result').html($('#result').html() + '7');
                    break;
                case 104:
                case 56:
                    $('#result').html($('#result').html() + '8');
                    break;
                case 105:
                case 57:
                    $('#result').html($('#result').html() + '9');
                    break;
                case 13:
                    $('.btn-num').attr('disabled', 'disabled');
                    M.resolve($('#result').html());
                    break;
                case 46:
                case 8:
                    $('#result').html('');
                    break;
            }
        });

        /*
        $('#select').hide();
        $('#main').show();
        M.init( ['1x1'], $('#num').val() );
        M.next();
        */

    });

</script>

</body>
</html>